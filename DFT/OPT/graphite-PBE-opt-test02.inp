#Generated by Multiwfn
&GLOBAL
  PROJECT graphite-PBE-opt-test02
  PRINT_LEVEL LOW
  RUN_TYPE CELL_OPT
&END GLOBAL

&FORCE_EVAL
  METHOD Quickstep
  &SUBSYS
    &CELL
      A     4.92000000     0.00000000     0.00000000
      B    -2.46000000     4.26084499     0.00000000
      C     0.00000000     0.00000000     6.80000000
      PERIODIC XYZ #Direction(s) of applied PBC (geometry aspect)
    &END CELL
    &COORD
      C           0.00000000    0.00000000    1.70000000
      C           0.00000000    0.00000000    5.10000000
      C           0.00000000    1.42000000    1.70000000
      C           1.23000000    0.71000000    5.10000000
      C           2.46000000    0.00000000    1.70000000
      C           2.46000000    0.00000000    5.10000000
      C           2.46000000    1.42000000    1.70000000
      C           3.69000000    0.71000000    5.10000000
      C          -1.23000000    2.13000000    1.70000000
      C          -1.23000000    2.13000000    5.10000000
      C          -1.23000000    3.55100000    1.70000000
      C           0.00000000    2.84100000    5.10000000
      C           1.23000000    2.13000000    1.70000000
      C           1.23000000    2.13000000    5.10000000
      C           1.23000000    3.55100000    1.70000000
      C           2.46000000    2.84100000    5.10000000
    &END COORD
    &KIND C
      ELEMENT C
      BASIS_SET DZVP-MOLOPT-SR-GTH-q4
      POTENTIAL GTH-PBE
    &END KIND
  &END SUBSYS

  &DFT
    BASIS_SET_FILE_NAME  BASIS_MOLOPT
    POTENTIAL_FILE_NAME  POTENTIAL
#   WFN_RESTART_FILE_NAME graphite-PBE-opt-test-RESTART.wfn
    CHARGE    0 #Net charge
    MULTIPLICITY    1 #Spin multiplicity
	
    &KPOINTS
      SCHEME MONKHORST-PACK  8  8  4
    &END KPOINTS
	
    &QS
      EPS_DEFAULT 1.0E-12 #Set all EPS_xxx to values such that the energy will be correct up to this value
      #EXTRAPOLATION USE_PREV_P #Use converged density matrix of last geometry as initial guess
    &END QS
	
    &POISSON
      PERIODIC XYZ #Direction(s) of PBC for calculating electrostatics
      PSOLVER PERIODIC #The way to solve Poisson equation
    &END POISSON
	
    &XC
      &XC_FUNCTIONAL PBE
      &END XC_FUNCTIONAL
      &VDW_POTENTIAL
        POTENTIAL_TYPE PAIR_POTENTIAL
        &PAIR_POTENTIAL
          PARAMETER_FILE_NAME dftd3.dat
          TYPE DFTD3
          REFERENCE_FUNCTIONAL PBE
          #CALCULATE_C9_TERM T #Calculate C9-related three-body term, more accurate for large system
        &END PAIR_POTENTIAL
      &END VDW_POTENTIAL
    &END XC
	
    &MGRID
      CUTOFF  400
      REL_CUTOFF  55
    &END MGRID
	
    &SCF
      MAX_SCF 128
      EPS_SCF 1.0E-06 #Convergence threshold of density matrix of inner SCF
#     SCF_GUESS RESTART #Use wavefunction from WFN_RESTART_FILE_NAME file as initial guess
      &DIAGONALIZATION
        ALGORITHM STANDARD #Algorithm for diagonalization. DAVIDSON is faster for large systems
      &END DIAGONALIZATION
      &MIXING #How to mix old and new density matrices
        METHOD BROYDEN_MIXING #PULAY_MIXING is also a good alternative
        ALPHA 0.4 #Default. Mixing 40% of new density matrix with the old one
        NBROYDEN 8 #Default is 4. Number of previous steps stored for the actual mixing scheme
      &END MIXING
      &PRINT
        &RESTART #Note: Use "&RESTART OFF" can prevent generating .wfn file
          BACKUP_COPIES 0 #Maximum number of backup copies of wfn file. 0 means never
        &END RESTART
      &END PRINT
    &END SCF
  &END DFT
  
  &PRINT
    &STRESS_TENSOR ON #Print stress tensor
    &END STRESS_TENSOR
  &END PRINT
  STRESS_TENSOR ANALYTICAL #Compute full stress tensor analytically
&END FORCE_EVAL

&MOTION
  &CELL_OPT
    MAX_ITER 400 #Maximum number of geometry optimization
    EXTERNAL_PRESSURE  1.01325E+00 #External pressure for cell optimization (bar)
    CONSTRAINT NONE #Constraint of cell length, can be: NONE, X, Y, Z, XY, XZ, YZ
    KEEP_ANGLES F #If T, then cell angles will be kepted
    KEEP_SYMMETRY F #If T, then cell symmetry specified by &CELL / SYMMETRY will be kepted
    KEEP_SPACE_GROUP F #If T, then space group will be detected and preserved
    TYPE DIRECT_CELL_OPT #Geometry and cell are optimized at the same time. Can also be GEO_OPT, MD
    #The following thresholds of optimization convergence are the default ones
    MAX_DR 3E-3 #Maximum geometry change
    RMS_DR 1.5E-3 #RMS geometry change
    MAX_FORCE 4.5E-4 #Maximum force
    RMS_FORCE 3E-4 #RMS force
    PRESSURE_TOLERANCE 100 #Pressure tolerance (w.r.t EXTERNAL_PRESSURE)
    OPTIMIZER BFGS #Can also be CG (more robust for difficult cases) or LBFGS
    &BFGS
      TRUST_RADIUS 0.2 #Trust radius (maximum stepsize) in Angstrom
#     RESTART_HESSIAN T #If read initial Hessian, uncomment this line and specify the file in the next line
#     RESTART_FILE_NAME to_be_specified
    &END BFGS
  &END CELL_OPT
  &PRINT
    &TRAJECTORY
      FORMAT pdb
    &END TRAJECTORY
    &RESTART
      BACKUP_COPIES 0 #Maximum number of backing up restart file, 0 means never
    &END RESTART
    &RESTART_HISTORY OFF 
    &END RESTART_HISTORY
  &END PRINT
&END MOTION
